<nav class="navbar navbar-default navbar-fixed-top" role="navigation" style="margin-bottom: 0">
    <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".sidebar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">Longbourn Dashboard</a>
    </div>
    <!-- /.navbar-header -->

    <ul class="nav navbar-top-links navbar-right">
        <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                <i class="fa fa-envelope fa-fw"></i>  <i class="fa fa-caret-down"></i>
            </a>
            <ul class="dropdown-menu dropdown-messages">
                <%get_notifications(session[:user_id]).each do |notification|%>
                    <li <%=seen_notifications(notification.id)%>>
                        <%=link_to :controller => "notifications", :action =>"index", :params => {:selected => notification.id} do%>
                            <div>
                                <strong><%=notification.subject%></strong>
                                <span class="pull-right text-muted">
                                    <em><%=notification.created_at.strftime("%d-%m-%Y")%></em>
                                </span>
                            </div>
                            <div><%=truncate(notification.message, :length => 70, :separator => ' ')%></div>
                        <%end%>
                    </li>
                    <li class="divider"></li> 
                <%end%>
                <li>
                    <a class="text-center" href="#">
                        <strong>Leer Todas</strong>
                        <i class="fa fa-angle-right"></i>
                    </a>
                </li>
            </ul>
            <!-- /.dropdown-messages -->
        </li>
        <!-- /.dropdown -->
        <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                <i class="fa fa-tasks fa-fw"></i>  <i class="fa fa-caret-down"></i>
            </a>
            <ul class="dropdown-menu dropdown-tasks">
                <li>
                    <a href="#">
                        <div>
                            <p>
                                <strong>Task 1</strong>
                                <span class="pull-right text-muted">40% Complete</span>
                            </p>
                            <div class="progress progress-striped active">
                                <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                    <span class="sr-only">40% Complete (success)</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </li>
                <li class="divider"></li>
                <li>
                    <a href="#">
                        <div>
                            <p>
                                <strong>Task 2</strong>
                                <span class="pull-right text-muted">20% Complete</span>
                            </p>
                            <div class="progress progress-striped active">
                                <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%">
                                    <span class="sr-only">20% Complete</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </li>
                <li class="divider"></li>
                <li>
                    <a href="#">
                        <div>
                            <p>
                                <strong>Task 3</strong>
                                <span class="pull-right text-muted">60% Complete</span>
                            </p>
                            <div class="progress progress-striped active">
                                <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                    <span class="sr-only">60% Complete (warning)</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </li>
                <li class="divider"></li>
                <li>
                    <a href="#">
                        <div>
                            <p>
                                <strong>Task 4</strong>
                                <span class="pull-right text-muted">80% Complete</span>
                            </p>
                            <div class="progress progress-striped active">
                                <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                    <span class="sr-only">80% Complete (danger)</span>
                                </div>
                            </div>
                        </div>
                    </a>
                </li>
                <li class="divider"></li>
                <li>
                    <a class="text-center" href="#">
                        <strong>See All Tasks</strong>
                        <i class="fa fa-angle-right"></i>
                    </a>
                </li>
            </ul>
            <!-- /.dropdown-tasks -->
        </li>
        <!-- /.dropdown -->
        <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                <i class="fa fa-user fa-fw"></i>  <i class="fa fa-caret-down"></i>
            </a>
            <ul class="dropdown-menu dropdown-user">
                <li><%=link_to "<i class='fa fa-user fa-fw'></i> User Profile".html_safe%>
                </li>
                <li><%=link_to "<i class='fa fa-gear fa-fw'></i> Settings".html_safe%>
                </li>
                <li class="divider"></li>
                <li><%=link_to "<i class='fa fa-sign-out fa-fw'></i> Logout".html_safe, :controller => "users", :action => "logout"%>
                </li>
            </ul>
            <!-- /.dropdown-user -->
        </li>
        <!-- /.dropdown -->
    </ul>
    <!-- /.navbar-top-links -->


    <div class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav" id="side-menu">
                <li class="sidebar-search">
                    <%=form_tag({:controller => "reports", :action => "clients"}, method: :get) do%>
                        <div class="input-group custom-search-form">
                          <%=text_field_tag "institution_name", nil, class: "form-control", placeholder: "Buscar" %>
                          <span class="input-group-btn">
                            <%=button_tag "<i class='fa fa-search'></i>".html_safe, class: "btn btn-default"%>
                          </span>
                        </div>
                    <%end%>
                    <!-- /input-group -->
                </li>
                <li>
                    <%=link_to "<i class='fa fa-dashboard fa-fw'></i> Dashboard".html_safe, :controller => "main", :action => "index" %>
                </li>
                <li>
                    <a href="#"><i class="fa fa-files-o fa-fw"></i> Reportes<span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level">
                        <li>
                            <%=link_to "Reportes Actuales", :controller => "reports", :action => "clients"%>
                        </li>
                        <li>
                            <%=link_to "Reportes Historicos", :controller => "reports", :action => "historical"%>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#"><i class="fa fa-bell fa-fw"></i> Solicitudes<span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level">
                        <li>
                            <%=link_to "Solicitudes Enviadas".html_safe, :controller => "requests", :action => "sent_requests"%>
                        </li>
                        <li>
                            <%=link_to "Mis Solicitudes".html_safe, :controller => "requests", :action => "index"%>
                        </li>
                        <li>
                            <%=link_to "Crear Solicitud".html_safe, :controller => "requests", :action => "new_request"%>
                        </li>
                        <%if session[:usertype] <= 2 && is_area_manager(session[:user_id]) == true%>
                            <li>
                                <a href="#">Solicitudes de √Årea<span class="fa arrow"></span></a>
                                <%areas_for_user().each do |area|%>
                                    <ul class="nav nav-third-level">
                                        <li>
                                            <%=link_to area.areaname, :controller => "requests", :action => "area_requests", :id => area.id%>
                                        </li>
                                    </ul>
                                <%end%>
                            </li>
                        <%end%>
                        <%if session[:usertype] <= 1%>
                            <li>
                                <%=link_to "Todas las Solicitudes".html_safe, :controller => "requests", :action => "all_requests"%>
                            </li>
                        <%end%>
                    </ul>
                </li>
                <li>
                    <%=link_to "<i class='fa fa-envelope fa-fw'></i>  Notificaciones".html_safe, :controller => "notifications", :action => "index" %>
                </li>
                <li>
                    <a href="#"><i class="fa fa-bar-chart-o fa-fw"></i> Extras<span class="fa arrow"></span></a>
                    <ul class="nav nav-second-level">
                        <li>
                            <a href="#">Placeholder 1</a>
                        </li>
                        <li>
                            <a href="#">Placeholder 2</a>
                        </li>
                    </ul>
                </li>
            </ul>
            <!-- /#side-menu -->
        </div>
        <!-- /.sidebar-collapse -->
    </div>
    <!-- /.navbar-static-side -->
</nav>

<script>
$(function () {
    $('#side-menu').metisMenu({
      toggle: false
    });
});

//Loads the correct sidebar on window load,
//collapses the sidebar on window resize.
$(function() {
    $(window).bind("load resize", function() {
        width = (this.window.innerWidth > 0) ? this.window.innerWidth : this.screen.width;
        if (width < 768) {
            $('div.sidebar-collapse').addClass('collapse')
        } else {
            $('div.sidebar-collapse').removeClass('collapse')
        }
    })
})
</script>

